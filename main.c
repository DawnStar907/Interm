#include <ncurses.h>
#include <dirent.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/stat.h>
#include <sys/wait.h>
#include <errno.h>
#include <stdio.h>
#include <ctype.h>
#include <sys/types.h>
#include <fcntl.h>
#include <signal.h>
#include <sys/sysinfo.h>
#include <sys/statvfs.h>
#define MAX_FILES 1024
#define MAX_FILENAME 255
void list_files(const char*a,char b[MAX_FILES][256],int*c){DIR*d=opendir(a);struct dirent*e;*c=0;if(!d)return;while((e=readdir(d))!=NULL&&*c<MAX_FILES){strncpy(b[*c],e->d_name,255);b[*c][255]='\0';(*c)++;}closedir(d);}
int file_color(const char*a,const char*b){char c[1024];struct stat d;snprintf(c,sizeof(c),"%s/%s",a,b);if(lstat(c,&d)==0){if(S_ISDIR(d.st_mode))return 4;else if(S_ISLNK(d.st_mode))return 7;else if(d.st_mode&S_IXUSR)return 5;else if(S_ISREG(d.st_mode))return 6;}return 6;}
void draw_gradient_box(int a,int b,int c,int d){for(int e=0;e<c;++e){int f=1+(e%7);attron(COLOR_PAIR(f));mvhline(a+e,b,' ',d);attroff(COLOR_PAIR(f));}attron(COLOR_PAIR(2)|A_BOLD);mvaddch(a,b,ACS_ULCORNER);mvaddch(a,b+d-1,ACS_URCORNER);mvaddch(a+c-1,b,ACS_LLCORNER);mvaddch(a+c-1,b+d-1,ACS_LRCORNER);mvhline(a,b+1,ACS_HLINE,d-2);mvhline(a+c-1,b+1,ACS_HLINE,d-2);mvvline(a+1,b,ACS_VLINE,c-2);mvvline(a+1,b+d-1,ACS_VLINE,c-2);attroff(COLOR_PAIR(2)|A_BOLD);}
int main(){char a[1024],b[MAX_FILES][256];int c=0,d=0;if(!getcwd(a,sizeof(a)))return 1;initscr();noecho();cbreak();keypad(stdscr,1);nodelay(stdscr,0);if(has_colors()){start_color();use_default_colors();init_pair(1,COLOR_BLACK,COLOR_CYAN);init_pair(2,COLOR_YELLOW,COLOR_BLUE);init_pair(3,COLOR_GREEN,-1);init_pair(4,COLOR_BLUE,-1);init_pair(5,COLOR_RED,-1);init_pair(6,COLOR_WHITE,-1);init_pair(7,COLOR_MAGENTA,-1);init_pair(8,COLOR_CYAN,-1);init_pair(9,COLOR_MAGENTA,COLOR_CYAN);}while(1){clear();int e=LINES-2,f=COLS-2,g=COLS/2;attron(COLOR_PAIR(2)|A_BOLD|A_REVERSE);for(int h=1;h<COLS-1;h++)mvaddch(1,h,' ');mvprintw(1,3," Interm || %s ",a);attroff(COLOR_PAIR(2)|A_BOLD|A_REVERSE);attron(COLOR_PAIR(9));mvaddch(0,0,ACS_DIAMOND);mvaddch(0,COLS-1,ACS_DIAMOND);mvaddch(LINES-1,0,ACS_DIAMOND);mvaddch(LINES-1,COLS-1,ACS_DIAMOND);attroff(COLOR_PAIR(9));for(int h=1;h<COLS-1;h++){attron(COLOR_PAIR(2));mvaddch(0,h,ACS_HLINE);mvaddch(LINES-1,h,ACS_HLINE);attroff(COLOR_PAIR(2));}for(int h=1;h<LINES-1;h++){attron(COLOR_PAIR(2));mvaddch(h,0,ACS_VLINE);mvaddch(h,COLS-1,ACS_VLINE);attroff(COLOR_PAIR(2));}box(stdscr,0,0);attron(COLOR_PAIR(8)|A_BOLD);mvprintw(3,3,"Files: %d",c);attroff(COLOR_PAIR(8)|A_BOLD);list_files(a,b,&c);int h=e-5,i=0;if(d>=h)i=d-h+1;for(int j=0;j<c&&j<h;j++){int k=j+i,l=file_color(a,b[k]);if(k==d){attron(COLOR_PAIR(1)|A_BOLD|A_REVERSE);mvprintw(j+4,2,"  %-*s",g-4,b[k]);attroff(COLOR_PAIR(1)|A_BOLD|A_REVERSE);}else{attron(COLOR_PAIR(l));mvprintw(j+4,4,"%-*s",g-6,b[k]);attroff(COLOR_PAIR(l));}}attron(COLOR_PAIR(3)|A_BOLD);mvprintw(LINES-2,2,"↑/↓ or w/s: Move  Enter: Open Dir  e: Edit  n: New  d: Delete  q: Quit");attroff(COLOR_PAIR(3)|A_BOLD);refresh();int m=getch();if(m!=ERR){switch(m){case KEY_UP:case 'w':if(d>0)d--;break;case KEY_DOWN:case 's':if(d<c-1)d++;break;case 10:{char n[1024];snprintf(n,sizeof(n),"%s/%s",a,b[d]);struct stat o;if(stat(n,&o)==0){if(S_ISDIR(o.st_mode)){DIR*p=opendir(n);if(p){closedir(p);strcpy(a,n);d=0;}}}}break;case 'e':{char n[1024];snprintf(n,sizeof(n),"%s/%s",a,b[d]);struct stat o;if(stat(n,&o)==0&&S_ISREG(o.st_mode)){const char*q=getenv("EDITOR");if(!q)q="nano";endwin();char r[1200];snprintf(r,sizeof(r),"%s \"%s\"",q,n);system(r);initscr();noecho();cbreak();keypad(stdscr,1);}}break;case'n':{echo();curs_set(1);char s[256]={0};mvprintw(LINES-3,2,"New file name (with extension): ");int t,u;getyx(stdscr,t,u);mvgetnstr(t,u,s,sizeof(s)-1);noecho();curs_set(0);if(s[0]=='\0'||strchr(s,'/')!=NULL){mvprintw(LINES-3,2,"Invalid file name! Press any key...");clrtoeol();getch();break;}char v[1024];snprintf(v,sizeof(v),"%s/%s",a,s);FILE*w=fopen(v,"w");if(!w){mvprintw(LINES-3,2,"Failed to create file! Press any key...");clrtoeol();getch();break;}fclose(w);const char*q=getenv("EDITOR");if(!q)q="nano";endwin();char r[1200];snprintf(r,sizeof(r),"%s \"%s\"",q,v);system(r);initscr();noecho();cbreak();keypad(stdscr,1);}break;case'd':{char n[1024];snprintf(n,sizeof(n),"%s/%s",a,b[d]);struct stat o;if(stat(n,&o)==0&&S_ISREG(o.st_mode)){attron(COLOR_PAIR(5)|A_BOLD);mvprintw(LINES-3,2,"Delete '%s'? This cannot be undone! (y/N): ",b[d]);attroff(COLOR_PAIR(5)|A_BOLD);int x=getch();if(x=='y'||x=='Y'){if(remove(n)==0){mvprintw(LINES-3,2,"File deleted. Press any key...");clrtoeol();getch();if(d>0)d--;}else{mvprintw(LINES-3,2,"Failed to delete file! Press any key...");clrtoeol();getch();}}else{mvprintw(LINES-3,2,"Delete cancelled. Press any key...");clrtoeol();getch();}}}break;case'q':endwin();return 0;}}}endwin();return 0;}